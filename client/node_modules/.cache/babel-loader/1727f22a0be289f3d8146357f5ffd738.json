{"ast":null,"code":"import _regeneratorRuntime from\"/Users/richard/Documents/GitHub/time_capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/richard/Documents/GitHub/time_capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/richard/Documents/GitHub/time_capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/richard/Documents/GitHub/time_capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2;import React,{useState}from\"react\";import crypto from\"crypto\";import styled from\"styled-components\";import{getCapsuleMessage}from\"../services/contracthelper\";import{ValidationError}from\"../styles/ValidationError\";import Popup from\"./Popup\";import TextInput from\"./TextInput\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var StyledUnlockMsg=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n\"])));var MessageBox=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  font-size: 2.5rem;\\n  margin-bottom: 1rem;\\n  color: var(--sub);\\n  width: 50rem;\\n  word-wrap: break-word;\\n  white-space: normal;\\n\"])));var unlockMsg=function unlockMsg(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),passwordError=_useState4[0],setPasswordError=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),password=_useState6[0],setPassword=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),encMessage=_useState8[0],setEncMessage=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),rightPasswordFlag=_useState10[0],setRightPasswordFlag=_useState10[1];var validatePassword=function validatePassword(value){if(value.length!==32)setPasswordError(\"Please input 32-digit password\");else{setPasswordError(\"\");return true;}return false;};function aesDecrypt(crypted,key){if(crypted===\"\")return\"\";try{var decipher=crypto.createDecipheriv(\"aes-128-cbc\",key.slice(0,16),key.slice(16));var decrypted=decipher.update(crypted,\"hex\",\"utf8\");decrypted+=decipher.final(\"utf8\");var value=unescape(decrypted);return value;}catch(e){console.log(e);return\"E:\";}}var getMD5=function getMD5(value){var hash=crypto.createHash(\"md5\");hash.update(value);return hash.digest(\"hex\");// 7e1977739c748beac0c0fd14fd26a544\n};var click=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var returnMessage,hashMessage;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(validatePassword(password)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setLoading(true);_context.next=5;return getCapsuleMessage(props.capsuleId);case 5:returnMessage=_context.sent;hashMessage=aesDecrypt(returnMessage,password);if(hashMessage.length>32&&hashMessage.slice(0,32)===getMD5(\"PF:\".concat(hashMessage.slice(32)))){setEncMessage(hashMessage.slice(32));setRightPasswordFlag(true);setPasswordError(\"\");}else{setRightPasswordFlag(false);setPasswordError(\"Wrong Password\");setPassword(\"\");}setLoading(false);// props.close();\ncase 9:case\"end\":return _context.stop();}}},_callee);}));return function click(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Popup,{show:props.show,close:function close(){return props.close();},header:\"Message\",buttonText:\"Check\",buttonAction:function buttonAction(){click();},secondButtonText:\"Close\",secondButtonAction:function secondButtonAction(){props.close();},buttonDisabled:rightPasswordFlag,loading:loading,content:/*#__PURE__*/_jsxs(StyledUnlockMsg,{children:[!rightPasswordFlag&&/*#__PURE__*/_jsx(TextInput,{label:\"Input your password for the message\",placeholder:\"32-digit Password\"// tooltip=\"This is the password provided by the sender of the Capsule.\"\n,value:password,setValue:function setValue(value){validatePassword(value);setPassword(value);}}),passwordError&&!rightPasswordFlag&&/*#__PURE__*/_jsx(ValidationError,{children:passwordError}),encMessage!==\"\"&&/*#__PURE__*/_jsx(MessageBox,{children:encMessage})]})});};export default unlockMsg;","map":{"version":3,"sources":["/Users/richard/Documents/GitHub/time_capsule/client/src/components/UnlockMsg.tsx"],"names":["React","useState","crypto","styled","getCapsuleMessage","ValidationError","Popup","TextInput","StyledUnlockMsg","div","MessageBox","unlockMsg","props","loading","setLoading","passwordError","setPasswordError","password","setPassword","encMessage","setEncMessage","rightPasswordFlag","setRightPasswordFlag","validatePassword","value","length","aesDecrypt","crypted","key","decipher","createDecipheriv","slice","decrypted","update","final","unescape","e","console","log","getMD5","hash","createHash","digest","click","capsuleId","returnMessage","hashMessage","concat","show","close"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport crypto from \"crypto\";\nimport styled from \"styled-components\";\nimport { getCapsuleMessage } from \"../services/contracthelper\";\nimport { ValidationError } from \"../styles/ValidationError\";\nimport Popup from \"./Popup\";\nimport TextInput from \"./TextInput\";\n\nconst StyledUnlockMsg = styled.div`\n  width: 100%;\n`;\n\nconst MessageBox = styled.div`\n  font-size: 2.5rem;\n  margin-bottom: 1rem;\n  color: var(--sub);\n  width: 50rem;\n  word-wrap: break-word;\n  white-space: normal;\n`;\n\ntype Props = {\n  show: boolean;\n  close: () => void;\n  capsuleId: number;\n  // updateCapsules: () => void;\n};\n\nconst unlockMsg = (props: Props): JSX.Element => {\n  const [loading, setLoading] = useState(false);\n  const [passwordError, setPasswordError] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [encMessage, setEncMessage] = useState(\"\");\n  const [rightPasswordFlag, setRightPasswordFlag] = useState(false);\n\n  const validatePassword = (value: string): boolean => {\n    if (value.length !== 32) setPasswordError(\"Please input 32-digit password\");\n    else {\n      setPasswordError(\"\");\n      return true;\n    }\n    return false;\n  };\n\n  function aesDecrypt(crypted: string, key: string): string {\n    if (crypted === \"\") return \"\";\n    try {\n      const decipher = crypto.createDecipheriv(\n        \"aes-128-cbc\",\n        key.slice(0, 16),\n        key.slice(16)\n      );\n      let decrypted = decipher.update(crypted, \"hex\", \"utf8\");\n      decrypted += decipher.final(\"utf8\");\n      const value = unescape(decrypted);\n      return value;\n    } catch (e) {\n      console.log(e);\n      return \"E:\";\n    }\n  }\n\n  const getMD5 = (value: string): string => {\n    const hash = crypto.createHash(\"md5\");\n    hash.update(value);\n    return hash.digest(\"hex\"); // 7e1977739c748beac0c0fd14fd26a544\n  };\n\n  const click = async () => {\n    if (!validatePassword(password)) return;\n    setLoading(true);\n    const returnMessage = await getCapsuleMessage(props.capsuleId);\n    const hashMessage = aesDecrypt(returnMessage, password);\n\n    if (\n      hashMessage.length > 32 &&\n      hashMessage.slice(0, 32) === getMD5(\"PF:\".concat(hashMessage.slice(32)))\n    ) {\n      setEncMessage(hashMessage.slice(32));\n      setRightPasswordFlag(true);\n      setPasswordError(\"\");\n    } else {\n      setRightPasswordFlag(false);\n      setPasswordError(\"Wrong Password\");\n      setPassword(\"\");\n    }\n    setLoading(false);\n    // props.close();\n  };\n\n  return (\n    <Popup\n      show={props.show}\n      close={() => props.close()}\n      header=\"Message\"\n      buttonText=\"Check\"\n      buttonAction={() => {\n        click();\n      }}\n      secondButtonText=\"Close\"\n      secondButtonAction={() => {\n        props.close();\n      }}\n      buttonDisabled={rightPasswordFlag}\n      loading={loading}\n      content={\n        <StyledUnlockMsg>\n          {!rightPasswordFlag && (\n            <TextInput\n              label=\"Input your password for the message\"\n              placeholder=\"32-digit Password\"\n              // tooltip=\"This is the password provided by the sender of the Capsule.\"\n              value={password}\n              setValue={(value: string) => {\n                validatePassword(value);\n                setPassword(value);\n              }}\n            />\n          )}\n          {passwordError && !rightPasswordFlag && (\n            <ValidationError>{passwordError}</ValidationError>\n          )}\n          {encMessage !== \"\" && <MessageBox>{encMessage}</MessageBox>}\n        </StyledUnlockMsg>\n      }\n    />\n  );\n};\n\nexport default unlockMsg;\n"]},"metadata":{},"sourceType":"module"}