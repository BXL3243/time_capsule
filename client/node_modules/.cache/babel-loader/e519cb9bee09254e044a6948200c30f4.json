{"ast":null,"code":"import _regeneratorRuntime from\"/Users/richard/Documents/GitHub/time_sapsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/richard/Documents/GitHub/time_sapsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/richard/Documents/GitHub/time_sapsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/richard/Documents/GitHub/time_sapsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9;import React,{useEffect,useRef,useState}from\"react\";import styled from\"styled-components\";import{ethBalance,tokenBalance}from\"../services/contracthelper\";import{toCents}from\"../services/web3Service\";import Input from\"./Input\";import{ValidationError}from\"../styles/ValidationError\";import TokenSelector from\"./TokenSelector\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var StyledTokenInput=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  border-radius: 2rem;\\n  display: flex;\\n  padding-top: 1rem;\\n\"])));var Container=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  padding: 1rem;\\n  border: solid 2px var(--main);\\n  align-items: center;\\n  width: 13rem;\\n  position: relative;\\n  margin-right: 3rem;\\n  height: 4.8rem;\\n\"])));var OpenButton=styled.button(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  width: 100%;\\n  height: 100%;\\n  top: 0;\\n  left: 0;\\n  cursor: pointer;\\n\"])));var Image=styled.img(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  height: 1.6rem;\\n  margin-right: 1rem;\\n  background-color: var(--bg);\\n  border-radius: 50%;\\n\"])));var Name=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  color: var(--main);\\n  font-size: 1.6rem;\\n  font-weight: 500;\\n  margin-right: 1rem;\\n\"])));var Arrow=styled.div(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  font-size: 2rem;\\n  color: var(--main);\\n  position: absolute;\\n  font-weight: 200;\\n  font-family: Arial, Helvetica, sans-serif;\\n  top: 50%;\\n  right: 1rem;\\n  transform: translateY(-50%) rotate(90deg);\\n\"])));var InputContainer=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  position: relative;\\n  display: flex;\\n  flex-direction: column;\\n  flex: 1;\\n\"])));var MaxButton=styled.button(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  font-size: 1.9rem;\\n  text-transform: uppercase;\\n  color: var(--primary);\\n  font-weight: 600;\\n  position: absolute;\\n  right: 1rem;\\n  top: 1.4rem;\\n  cursor: pointer;\\n  height: 2rem;\\n  background-color: var(--bg);\\n  padding: 0.5rem;\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n\"])));var RemoveAsset=styled.button(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  font-size: 1.9rem;\\n  font-weight: 500;\\n  color: var(--primary);\\n  text-decoration: underline;\\n  width: 9rem;\\n  cursor: pointer;\\n  margin-left: 1rem;\\n\"])));var TokenInput=function TokenInput(props){var tokenContainerRef=useRef(null);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),open=_useState2[0],setOpen=_useState2[1];var _useState3=useState(\"0\"),_useState4=_slicedToArray(_useState3,2),value=_useState4[0],_setValue=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),balance=_useState6[0],setBalance=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var updateBalance=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(token){var _balance,_balance2;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(token.address===\"ETH\")){_context.next=7;break;}_context.next=3;return ethBalance();case 3:_balance=_context.sent;setBalance(_balance);_context.next=11;break;case 7:_context.next=9;return tokenBalance(token);case 9:_balance2=_context.sent;setBalance(_balance2);case 11:case\"end\":return _context.stop();}}},_callee);}));return function updateBalance(_x){return _ref.apply(this,arguments);};}();var _setToken=function setToken(token,valueString,isTokenChange){setError(\"\");if(!isTokenChange){var number=\"0\";try{number=toCents(Number.parseFloat(valueString),token);}catch(_unused){setError(\"Not a valid number\");return;}if(Number.parseFloat(number)===0){setError(\"Value must be greater than 0\");return;}if(Number.parseFloat(valueString)>balance){setError(\"Value must be less than or equal to balance\");return;}}props.setToken(token,valueString);};useEffect(function(){updateBalance(props.token);},[]);return/*#__PURE__*/_jsxs(StyledTokenInput,{children:[/*#__PURE__*/_jsxs(Container,{ref:tokenContainerRef,children:[/*#__PURE__*/_jsx(Image,{src:props.token.logoURI,alt:\"\".concat(props.token.symbol,\" Token Image\")}),/*#__PURE__*/_jsx(Name,{children:props.token.symbol}),/*#__PURE__*/_jsx(Arrow,{children:\">\"}),/*#__PURE__*/_jsx(OpenButton,{onClick:function onClick(){return setOpen(true);}}),/*#__PURE__*/_jsx(TokenSelector,{open:open,token:props.token,setToken:function setToken(token){_setToken(token,value,true);updateBalance(token);setOpen(false);},parent:tokenContainerRef.current})]}),/*#__PURE__*/_jsxs(InputContainer,{children:[/*#__PURE__*/_jsx(Input,{placeholder:\"0.0\",value:value,setValue:function setValue(v){_setValue(v);_setToken(props.token,v,false);}}),/*#__PURE__*/_jsx(MaxButton,{onClick:function onClick(){return _setValue(balance.toString());},children:\"max\"}),error&&/*#__PURE__*/_jsx(ValidationError,{spacing:true,children:error})]}),props.removable&&/*#__PURE__*/_jsx(RemoveAsset,{onClick:function onClick(){return props.removeToken();},children:\"Remove\"})]});};export default TokenInput;","map":{"version":3,"sources":["/Users/richard/Documents/GitHub/time_sapsule/client/src/components/TokenInput.tsx"],"names":["React","useEffect","useRef","useState","styled","ethBalance","tokenBalance","toCents","Input","ValidationError","TokenSelector","StyledTokenInput","div","Container","OpenButton","button","Image","img","Name","Arrow","InputContainer","MaxButton","RemoveAsset","TokenInput","props","tokenContainerRef","open","setOpen","value","setValue","balance","setBalance","error","setError","updateBalance","token","address","_balance","setToken","valueString","isTokenChange","number","Number","parseFloat","logoURI","symbol","current","v","toString","removable","removeToken"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { ethBalance, tokenBalance } from \"../services/contracthelper\";\nimport { toCents } from \"../services/web3Service\";\nimport Input from \"./Input\";\nimport { ValidationError } from \"../styles/ValidationError\";\nimport Token from \"../types/Token\";\nimport TokenSelector from \"./TokenSelector\";\n\nconst StyledTokenInput = styled.div`\n  border-radius: 2rem;\n  display: flex;\n  padding-top: 1rem;\n`;\n\nconst Container = styled.div`\n  display: flex;\n  padding: 1rem;\n  border: solid 2px var(--main);\n  align-items: center;\n  width: 13rem;\n  position: relative;\n  margin-right: 3rem;\n  height: 4.8rem;\n`;\n\nconst OpenButton = styled.button`\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  cursor: pointer;\n`;\n\nconst Image = styled.img`\n  height: 1.6rem;\n  margin-right: 1rem;\n  background-color: var(--bg);\n  border-radius: 50%;\n`;\n\nconst Name = styled.div`\n  color: var(--main);\n  font-size: 1.6rem;\n  font-weight: 500;\n  margin-right: 1rem;\n`;\n\nconst Arrow = styled.div`\n  font-size: 2rem;\n  color: var(--main);\n  position: absolute;\n  font-weight: 200;\n  font-family: Arial, Helvetica, sans-serif;\n  top: 50%;\n  right: 1rem;\n  transform: translateY(-50%) rotate(90deg);\n`;\n\nconst InputContainer = styled.div`\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n`;\n\nconst MaxButton = styled.button`\n  font-size: 1.9rem;\n  text-transform: uppercase;\n  color: var(--primary);\n  font-weight: 600;\n  position: absolute;\n  right: 1rem;\n  top: 1.4rem;\n  cursor: pointer;\n  height: 2rem;\n  background-color: var(--bg);\n  padding: 0.5rem;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n`;\n\nconst RemoveAsset = styled.button`\n  font-size: 1.9rem;\n  font-weight: 500;\n  color: var(--primary);\n  text-decoration: underline;\n  width: 9rem;\n  cursor: pointer;\n  margin-left: 1rem;\n`;\n\ntype Props = {\n  token: Token;\n  setToken: (token: Token, value: string) => void;\n  removeToken: () => void;\n  removable: boolean;\n};\n\nconst TokenInput = (props: Props): JSX.Element => {\n  const tokenContainerRef = useRef<HTMLDivElement>(null);\n\n  const [open, setOpen] = useState(false);\n  const [value, setValue] = useState(\"0\");\n  const [balance, setBalance] = useState(0);\n  const [error, setError] = useState(\"\");\n\n  const updateBalance = async (token: Token) => {\n    if (token.address === \"ETH\") {\n      const _balance = await ethBalance();\n      setBalance(_balance);\n    } else {\n      const _balance = await tokenBalance(token);\n      setBalance(_balance);\n    }\n  };\n\n  const setToken = (\n    token: Token,\n    valueString: string,\n    isTokenChange: boolean\n  ) => {\n    setError(\"\");\n    if (!isTokenChange) {\n      let number = \"0\";\n      try {\n        number = toCents(Number.parseFloat(valueString), token);\n      } catch {\n        setError(\"Not a valid number\");\n        return;\n      }\n      if (Number.parseFloat(number) === 0) {\n        setError(\"Value must be greater than 0\");\n        return;\n      }\n      if (Number.parseFloat(valueString) > balance) {\n        setError(\"Value must be less than or equal to balance\");\n        return;\n      }\n    }\n    props.setToken(token, valueString);\n  };\n\n  useEffect(() => {\n    updateBalance(props.token);\n  }, []);\n\n  return (\n    <StyledTokenInput>\n      <Container ref={tokenContainerRef}>\n        <Image\n          src={props.token.logoURI}\n          alt={`${props.token.symbol} Token Image`}\n        />\n        <Name>{props.token.symbol}</Name>\n        <Arrow>{\">\"}</Arrow>\n        <OpenButton onClick={() => setOpen(true)} />\n        <TokenSelector\n          open={open}\n          token={props.token}\n          setToken={(token: Token) => {\n            setToken(token, value, true);\n            updateBalance(token);\n            setOpen(false);\n          }}\n          parent={tokenContainerRef.current}\n        />\n      </Container>\n      <InputContainer>\n        <Input\n          placeholder=\"0.0\"\n          value={value}\n          setValue={(v: string) => {\n            setValue(v);\n            setToken(props.token, v, false);\n          }}\n        />\n        <MaxButton onClick={() => setValue(balance.toString())}>max</MaxButton>\n        {error && <ValidationError spacing>{error}</ValidationError>}\n      </InputContainer>\n      {props.removable && (\n        <RemoveAsset onClick={() => props.removeToken()}>Remove</RemoveAsset>\n      )}\n    </StyledTokenInput>\n  );\n};\n\nexport default TokenInput;\n"]},"metadata":{},"sourceType":"module"}