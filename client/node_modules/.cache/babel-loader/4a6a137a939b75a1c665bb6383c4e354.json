{"ast":null,"code":"var _jsxFileName = \"/Users/richard/Documents/GitHub/time_capsule/client/src/components/UnlockMsg.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport crypto from \"crypto\";\nimport styled from \"styled-components\";\nimport { getCapsuleMessage } from \"../services/contracthelper\";\nimport { ValidationError } from \"../styles/ValidationError\";\nimport Popup from \"./Popup\";\nimport TextInput from \"./TextInput\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst StyledUnlockMsg = styled.div`\n  width: 100%;\n`;\n_c = StyledUnlockMsg;\nconst MessageBox = styled.div`\n  font-size: 2.5rem;\n  margin-bottom: 1rem;\n  color: var(--sub);\n  width: 50rem;\n  word-wrap: break-word;\n  white-space: normal;\n`;\n_c2 = MessageBox;\n\nconst unlockMsg = props => {\n  _s();\n\n  const [loading, setLoading] = useState(false);\n  const [passwordError, setPasswordError] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [encMessage, setEncMessage] = useState(\"\");\n  const [rightPasswordFlag, setRightPasswordFlag] = useState(false);\n\n  const validatePassword = value => {\n    if (value.length !== 32) setPasswordError(\"Please input 32-digit password\");else {\n      setPasswordError(\"\");\n      return true;\n    }\n    return false;\n  };\n\n  function aesDecrypt(crypted, key) {\n    if (crypted === \"\") return \"\";\n\n    try {\n      const decipher = crypto.createDecipheriv(\"aes-128-cbc\", key.slice(0, 16), key.slice(16));\n      let decrypted = decipher.update(crypted, \"hex\", \"utf8\");\n      decrypted += decipher.final(\"utf8\");\n      const value = unescape(decrypted);\n      return value;\n    } catch (e) {\n      console.log(e);\n      return \"E:\";\n    }\n  }\n\n  const getMD5 = value => {\n    const hash = crypto.createHash(\"md5\");\n    hash.update(value);\n    return hash.digest(\"hex\"); // 7e1977739c748beac0c0fd14fd26a544\n  };\n\n  const click = async () => {\n    if (!validatePassword(password)) return;\n    setLoading(true);\n    const returnMessage = await getCapsuleMessage(props.capsuleId);\n    const hashMessage = aesDecrypt(returnMessage, password);\n\n    if (hashMessage.length > 32 && hashMessage.slice(0, 32) === getMD5(\"PF:\".concat(hashMessage.slice(32)))) {\n      setEncMessage(hashMessage.slice(32));\n      setRightPasswordFlag(true);\n      setPasswordError(\"\");\n    } else {\n      setRightPasswordFlag(false);\n      setPasswordError(\"Wrong Password\");\n      setPassword(\"\");\n    }\n\n    setLoading(false); // props.close();\n  };\n\n  return /*#__PURE__*/_jsxDEV(Popup, {\n    show: props.show,\n    close: () => props.close(),\n    header: \"Message\",\n    buttonText: \"Check\",\n    buttonAction: () => {\n      click();\n    },\n    secondButtonText: \"Close\",\n    secondButtonAction: () => {\n      props.close();\n    },\n    buttonDisabled: rightPasswordFlag,\n    loading: loading,\n    content: /*#__PURE__*/_jsxDEV(StyledUnlockMsg, {\n      children: [!rightPasswordFlag && /*#__PURE__*/_jsxDEV(TextInput, {\n        label: \"Input your password for the message\",\n        placeholder: \"32-digit Password\" // tooltip=\"This is the password provided by the sender of the Capsule.\"\n        ,\n        value: password,\n        setValue: value => {\n          validatePassword(value);\n          setPassword(value);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 13\n      }, this), passwordError && !rightPasswordFlag && /*#__PURE__*/_jsxDEV(ValidationError, {\n        children: passwordError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 13\n      }, this), encMessage !== \"\" && /*#__PURE__*/_jsxDEV(MessageBox, {\n        children: encMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 33\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 5\n  }, this);\n};\n\n_s(unlockMsg, \"FpdloOzPDYk7MFl8ODe9k6hNfl0=\");\n\nexport default unlockMsg;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"StyledUnlockMsg\");\n$RefreshReg$(_c2, \"MessageBox\");","map":{"version":3,"sources":["/Users/richard/Documents/GitHub/time_capsule/client/src/components/UnlockMsg.tsx"],"names":["React","useState","crypto","styled","getCapsuleMessage","ValidationError","Popup","TextInput","StyledUnlockMsg","div","MessageBox","unlockMsg","props","loading","setLoading","passwordError","setPasswordError","password","setPassword","encMessage","setEncMessage","rightPasswordFlag","setRightPasswordFlag","validatePassword","value","length","aesDecrypt","crypted","key","decipher","createDecipheriv","slice","decrypted","update","final","unescape","e","console","log","getMD5","hash","createHash","digest","click","returnMessage","capsuleId","hashMessage","concat","show","close"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport crypto from \"crypto\";\nimport styled from \"styled-components\";\nimport { getCapsuleMessage } from \"../services/contracthelper\";\nimport { ValidationError } from \"../styles/ValidationError\";\nimport Popup from \"./Popup\";\nimport TextInput from \"./TextInput\";\n\nconst StyledUnlockMsg = styled.div`\n  width: 100%;\n`;\n\nconst MessageBox = styled.div`\n  font-size: 2.5rem;\n  margin-bottom: 1rem;\n  color: var(--sub);\n  width: 50rem;\n  word-wrap: break-word;\n  white-space: normal;\n`;\n\ntype Props = {\n  show: boolean;\n  close: () => void;\n  capsuleId: number;\n  // updateCapsules: () => void;\n};\n\nconst unlockMsg = (props: Props): JSX.Element => {\n  const [loading, setLoading] = useState(false);\n  const [passwordError, setPasswordError] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [encMessage, setEncMessage] = useState(\"\");\n  const [rightPasswordFlag, setRightPasswordFlag] = useState(false);\n\n  const validatePassword = (value: string): boolean => {\n    if (value.length !== 32) setPasswordError(\"Please input 32-digit password\");\n    else {\n      setPasswordError(\"\");\n      return true;\n    }\n    return false;\n  };\n\n  function aesDecrypt(crypted: string, key: string): string {\n    if (crypted === \"\") return \"\";\n    try {\n      const decipher = crypto.createDecipheriv(\n        \"aes-128-cbc\",\n        key.slice(0, 16),\n        key.slice(16)\n      );\n      let decrypted = decipher.update(crypted, \"hex\", \"utf8\");\n      decrypted += decipher.final(\"utf8\");\n      const value = unescape(decrypted);\n      return value;\n    } catch (e) {\n      console.log(e);\n      return \"E:\";\n    }\n  }\n\n  const getMD5 = (value: string): string => {\n    const hash = crypto.createHash(\"md5\");\n    hash.update(value);\n    return hash.digest(\"hex\"); // 7e1977739c748beac0c0fd14fd26a544\n  };\n\n  const click = async () => {\n    if (!validatePassword(password)) return;\n    setLoading(true);\n    const returnMessage = await getCapsuleMessage(props.capsuleId);\n    const hashMessage = aesDecrypt(returnMessage, password);\n\n    if (\n      hashMessage.length > 32 &&\n      hashMessage.slice(0, 32) === getMD5(\"PF:\".concat(hashMessage.slice(32)))\n    ) {\n      setEncMessage(hashMessage.slice(32));\n      setRightPasswordFlag(true);\n      setPasswordError(\"\");\n    } else {\n      setRightPasswordFlag(false);\n      setPasswordError(\"Wrong Password\");\n      setPassword(\"\");\n    }\n    setLoading(false);\n    // props.close();\n  };\n\n  return (\n    <Popup\n      show={props.show}\n      close={() => props.close()}\n      header=\"Message\"\n      buttonText=\"Check\"\n      buttonAction={() => {\n        click();\n      }}\n      secondButtonText=\"Close\"\n      secondButtonAction={() => {\n        props.close();\n      }}\n      buttonDisabled={rightPasswordFlag}\n      loading={loading}\n      content={\n        <StyledUnlockMsg>\n          {!rightPasswordFlag && (\n            <TextInput\n              label=\"Input your password for the message\"\n              placeholder=\"32-digit Password\"\n              // tooltip=\"This is the password provided by the sender of the Capsule.\"\n              value={password}\n              setValue={(value: string) => {\n                validatePassword(value);\n                setPassword(value);\n              }}\n            />\n          )}\n          {passwordError && !rightPasswordFlag && (\n            <ValidationError>{passwordError}</ValidationError>\n          )}\n          {encMessage !== \"\" && <MessageBox>{encMessage}</MessageBox>}\n        </StyledUnlockMsg>\n      }\n    />\n  );\n};\n\nexport default unlockMsg;\n"]},"metadata":{},"sourceType":"module"}