{"ast":null,"code":"import _regeneratorRuntime from\"/Users/richard/Documents/time-vault/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/richard/Documents/time-vault/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/richard/Documents/time-vault/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/richard/Documents/time-vault/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5;import React,{useEffect,useState}from\"react\";import{useSelector}from\"react-redux\";import styled from\"styled-components\";import{getAssetRealValue,getAssetSymbol}from\"../services/contracthelper\";import{selectAddress}from\"../state/userSlice\";import Button from\"./Button\";import AddAssets from\"./AddAssets\";import BlockContent from\"./BlockContent\";import UnlockMsg from\"./UnlockMsg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Header=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  font-size: 5rem;\\n  margin-bottom: 2rem;\\n  color: var(--main);\\n  text-align: center;\\n  transform: rotate(0deg);\\n  margin-top: -1rem;\\n\"])));var SubHeaderMain=styled.span(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  font-size: 2.5rem;\\n  color: var(--main);\\n  margin-right: 1rem;\\n\"])));var AssetContainer=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  margin: 1rem 0;\\n\"])));var TokenContainer=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  margin-right: 6rem;\\n\"])));var TokenAddress=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  font-size: 2rem;\\n  color: var(--sub);\\n\"])));// !!FOR TEST\nvar capMsg=\"\";capMsg=\"asadsad\";var capMsgKey=\"123213\";// !!FOR TEST\nvar CapsuleAssets=function CapsuleAssets(props){var address=useSelector(selectAddress);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),addingAssets=_useState2[0],setAddingAssets=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),assetValues=_useState4[0],setAssetValues=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),assetSymbols=_useState6[0],setAssetSymbols=_useState6[1];var isOpen=!props.capsule?false:new Date(props.capsule.distributionDate).getTime()<new Date().getTime();var updateAssets=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _assetValues,valuePromises,_assetSymbols,symbolPromises;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_assetValues=[];valuePromises=props.capsule.assets.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(asset){var realValue;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getAssetRealValue(asset);case 2:realValue=_context.sent;_assetValues.push({asset:asset.token,value:realValue});case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());_assetSymbols=[];symbolPromises=props.capsule.assets.map(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(asset){var _symbol;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getAssetSymbol(asset.token);case 2:_symbol=_context2.sent;_assetSymbols.push({asset:asset.token,symbol:_symbol});case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}());_context3.next=6;return Promise.all(valuePromises);case 6:setAssetValues(_assetValues);_context3.next=9;return Promise.all(symbolPromises);case 9:setAssetSymbols(_assetSymbols);case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function updateAssets(){return _ref.apply(this,arguments);};}();useEffect(function(){updateAssets();},[]);var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),UnlockingMsg=_useState8[0],setUnlockingMsg=_useState8[1];return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(BlockContent,{content:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{children:\"Vault Assets\"}),props.capsule.assets.map(function(asset){return/*#__PURE__*/_jsxs(AssetContainer,{children:[/*#__PURE__*/_jsxs(TokenContainer,{children:[/*#__PURE__*/_jsx(SubHeaderMain,{children:assetSymbols.length===props.capsule.assets.length?assetSymbols.filter(function(as){return as.asset===asset.token;})[0].symbol:\"---\"}),asset.token!==\"ETH\"&&/*#__PURE__*/_jsx(TokenAddress,{children:asset.token})]}),/*#__PURE__*/_jsx(SubHeaderMain,{children:assetValues.length===props.capsule.assets.length?assetValues.filter(function(av){return av.asset===asset.token;})[0].value:\"---\"})]});}),/*#__PURE__*/_jsxs(AssetContainer,{children:[/*#__PURE__*/_jsx(TokenContainer,{children:/*#__PURE__*/_jsx(SubHeaderMain,{children:\"Message\"})}),/*#__PURE__*/_jsx(Button,{primary:true,disabled:capMsg===\"\"||!props.capsule.empty,text:capMsg===\"\"?\"None\":!props.capsule.empty?\"Locked\":\"Input Password\",click:function click(){return setUnlockingMsg(true);}}),/*#__PURE__*/_jsx(UnlockMsg,{capsuleId:props.capsule.id,show:isOpen&&UnlockingMsg,close:function close(){return setUnlockingMsg(false);}// updateCapsules={() => props.update()}\n})]}),props.capsule.grantor===address&&props.capsule.addingAssetsAllowed&&!isOpen&&/*#__PURE__*/_jsx(Button,{primary:true,text:\"Add Assets\",click:function click(){return setAddingAssets(true);}})]})}),/*#__PURE__*/_jsx(AddAssets,{capsuleId:props.capsule.id,show:addingAssets,close:function close(){return setAddingAssets(false);},updateCapsules:function updateCapsules(){return props.update();}})]});};export default CapsuleAssets;","map":{"version":3,"sources":["/Users/richard/Documents/time-vault/client/src/components/CapsuleAssets.tsx"],"names":["React","useEffect","useState","useSelector","styled","getAssetRealValue","getAssetSymbol","selectAddress","Button","AddAssets","BlockContent","UnlockMsg","Header","div","SubHeaderMain","span","AssetContainer","TokenContainer","TokenAddress","capMsg","capMsgKey","CapsuleAssets","props","address","addingAssets","setAddingAssets","assetValues","setAssetValues","assetSymbols","setAssetSymbols","isOpen","capsule","Date","distributionDate","getTime","updateAssets","_assetValues","valuePromises","assets","map","asset","realValue","push","token","value","_assetSymbols","symbolPromises","_symbol","symbol","Promise","all","UnlockingMsg","setUnlockingMsg","length","filter","as","av","empty","id","grantor","addingAssetsAllowed","update"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\n\nimport { getAssetRealValue, getAssetSymbol } from \"../services/contracthelper\";\nimport { selectAddress } from \"../state/userSlice\";\nimport CapsuleType, { Asset } from \"../types/CapsuleType\";\n\nimport Button from \"./Button\";\nimport AddAssets from \"./AddAssets\";\nimport BlockContent from \"./BlockContent\";\nimport UnlockMsg from \"./UnlockMsg\";\n\nconst Header = styled.div`\n  font-size: 5rem;\n  margin-bottom: 2rem;\n  color: var(--main);\n  text-align: center;\n  transform: rotate(0deg);\n  margin-top: -1rem;\n`;\n\nconst SubHeaderMain = styled.span`\n  font-size: 2.5rem;\n  color: var(--main);\n  margin-right: 1rem;\n`;\n\nconst AssetContainer = styled.div`\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin: 1rem 0;\n`;\n\nconst TokenContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-right: 6rem;\n`;\n\nconst TokenAddress = styled.div`\n  font-size: 2rem;\n  color: var(--sub);\n`;\n\ntype AssetValue = {\n  asset: string;\n  value: number;\n};\n\ntype AssetSymbol = {\n  asset: string;\n  symbol: string;\n};\n\ntype Props = {\n  capsule: CapsuleType;\n  update: () => void;\n};\n\n// !!FOR TEST\nlet capMsg = \"\";\ncapMsg = \"asadsad\";\nconst capMsgKey = \"123213\";\n// !!FOR TEST\n\nconst CapsuleAssets = (props: Props): JSX.Element => {\n  const address = useSelector(selectAddress);\n\n  const [addingAssets, setAddingAssets] = useState(false);\n  const [assetValues, setAssetValues] = useState<AssetValue[]>([]);\n  const [assetSymbols, setAssetSymbols] = useState<AssetSymbol[]>([]);\n\n  const isOpen = !props.capsule\n    ? false\n    : new Date(props.capsule.distributionDate).getTime() < new Date().getTime();\n\n  const updateAssets = async () => {\n    const _assetValues: AssetValue[] = [];\n    const valuePromises = props.capsule.assets.map(async (asset: Asset) => {\n      const realValue = await getAssetRealValue(asset);\n      _assetValues.push({\n        asset: asset.token,\n        value: realValue,\n      });\n    });\n\n    const _assetSymbols: AssetSymbol[] = [];\n    const symbolPromises = props.capsule.assets.map(async (asset: Asset) => {\n      const _symbol = await getAssetSymbol(asset.token);\n      _assetSymbols.push({\n        asset: asset.token,\n        symbol: _symbol,\n      });\n    });\n\n    await Promise.all(valuePromises);\n    setAssetValues(_assetValues);\n    await Promise.all(symbolPromises);\n    setAssetSymbols(_assetSymbols);\n  };\n\n  useEffect(() => {\n    updateAssets();\n  }, []);\n\n  const [UnlockingMsg, setUnlockingMsg] = useState(false);\n\n  return (\n    <>\n      <BlockContent\n        content={\n          <>\n            <Header>Vault Assets</Header>\n            {props.capsule.assets.map((asset: Asset) => (\n              <AssetContainer>\n                <TokenContainer>\n                  <SubHeaderMain>\n                    {assetSymbols.length === props.capsule.assets.length\n                      ? assetSymbols.filter(\n                          (as: AssetSymbol) => as.asset === asset.token\n                        )[0].symbol\n                      : \"---\"}\n                  </SubHeaderMain>\n                  {asset.token !== \"ETH\" && (\n                    <TokenAddress>{asset.token}</TokenAddress>\n                  )}\n                </TokenContainer>\n                <SubHeaderMain>\n                  {assetValues.length === props.capsule.assets.length\n                    ? assetValues.filter(\n                        (av: AssetValue) => av.asset === asset.token\n                      )[0].value\n                    : \"---\"}\n                </SubHeaderMain>\n              </AssetContainer>\n            ))}\n            <AssetContainer>\n              <TokenContainer>\n                <SubHeaderMain>Message</SubHeaderMain>\n              </TokenContainer>\n              <Button\n                primary\n                disabled={capMsg === \"\" || !props.capsule.empty}\n                text={\n                  capMsg === \"\"\n                    ? \"None\"\n                    : !props.capsule.empty\n                    ? \"Locked\"\n                    : \"Input Password\"\n                }\n                click={() => setUnlockingMsg(true)}\n              />\n              <UnlockMsg\n                capsuleId={props.capsule.id}\n                show={isOpen && UnlockingMsg}\n                close={() => setUnlockingMsg(false)}\n                // updateCapsules={() => props.update()}\n              />\n            </AssetContainer>\n            {props.capsule.grantor === address &&\n              props.capsule.addingAssetsAllowed &&\n              !isOpen && (\n                <Button\n                  primary\n                  text=\"Add Assets\"\n                  click={() => setAddingAssets(true)}\n                />\n              )}\n          </>\n        }\n      />\n      <AddAssets\n        capsuleId={props.capsule.id}\n        show={addingAssets}\n        close={() => setAddingAssets(false)}\n        updateCapsules={() => props.update()}\n      />\n    </>\n  );\n};\n\nexport default CapsuleAssets;\n"]},"metadata":{},"sourceType":"module"}