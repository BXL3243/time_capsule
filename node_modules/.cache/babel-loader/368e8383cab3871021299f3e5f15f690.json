{"ast":null,"code":"var _jsxFileName = \"/Users/richard/Downloads/crypto-capsule/client/src/components/AddAssets.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport BN from \"bn.js\";\nimport styled from \"styled-components\";\nimport { addAssets, getTokenContract, tokenApproved } from \"../services/contracthelper\";\nimport { selectTokens } from \"../state/tokenSlice\";\nimport Assets from \"./Assets\";\nimport Popup from \"./Popup\";\nimport { getGlobals } from \"../utils/globals\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst StyledAddAssets = styled.div`\n  width: 100%;\n`;\n_c = StyledAddAssets;\n\nconst AddAssets = props => {\n  _s();\n\n  const tokens = useSelector(selectTokens);\n  const ethAsset = {\n    token: \"ETH\",\n    value: \"0\"\n  };\n  const approval = {\n    asset: ethAsset,\n    approved: true\n  };\n  const [assets, setAssets] = useState([ethAsset]);\n  const [loading, setLoading] = useState(false);\n  const [approvals, setApprovals] = useState([approval]);\n  const unapproved = approvals.filter(a => !a.approved);\n\n  const addressSymbol = address => tokens.filter(token => token.address === address)[0].symbol;\n\n  const tokenApprove = async address => {\n    const globals = await getGlobals();\n    const tokenContract = await getTokenContract(address);\n    tokenContract.methods.approve(globals.CAPSULE, new BN(\"9999999999999999999999999999\")).send().on(\"transactionHash\", hash => {\n      setLoading(true);\n    }).on(\"receipt\", async receipt => {\n      await updateApprovals(assets);\n      setLoading(false);\n    }).on(\"error\", err => {\n      console.log(`Error: ${err}`);\n      setLoading(false);\n    });\n  };\n\n  const updateApprovals = async assets => {\n    const _approvals = [];\n    const promises = assets.map(async asset => {\n      _approvals.push({\n        asset,\n        approved: await tokenApproved(asset.token)\n      });\n    });\n    await Promise.all(promises);\n    setApprovals(_approvals);\n  };\n\n  const click = async () => {\n    setLoading(true);\n    await addAssets(props.capsuleId, assets);\n    setLoading(false);\n    props.updateCapsules();\n    props.close();\n  };\n\n  return /*#__PURE__*/_jsxDEV(Popup, {\n    show: props.show,\n    close: props.close,\n    header: \"Add Assets\",\n    buttonText: unapproved.length === 0 ? \"Add Assets\" : `Approve ${addressSymbol(unapproved[0].asset.token)}`,\n    buttonAction: () => {\n      if (unapproved.length === 0) click();else tokenApprove(unapproved[0].asset.token);\n    },\n    loading: loading,\n    content: /*#__PURE__*/_jsxDEV(StyledAddAssets, {\n      children: /*#__PURE__*/_jsxDEV(Assets, {\n        assets: assets,\n        setAssets: assets => {\n          setAssets(assets);\n          updateApprovals(assets);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AddAssets, \"XwejLae+q6OUT80H2NmbaxjwQ+0=\", false, function () {\n  return [useSelector];\n});\n\n_c2 = AddAssets;\nexport default AddAssets;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"StyledAddAssets\");\n$RefreshReg$(_c2, \"AddAssets\");","map":{"version":3,"sources":["/Users/richard/Downloads/crypto-capsule/client/src/components/AddAssets.tsx"],"names":["React","useState","useSelector","BN","styled","addAssets","getTokenContract","tokenApproved","selectTokens","Assets","Popup","getGlobals","StyledAddAssets","div","AddAssets","props","tokens","ethAsset","token","value","approval","asset","approved","assets","setAssets","loading","setLoading","approvals","setApprovals","unapproved","filter","a","addressSymbol","address","symbol","tokenApprove","globals","tokenContract","methods","approve","CAPSULE","send","on","hash","receipt","updateApprovals","err","console","log","_approvals","promises","map","push","Promise","all","click","capsuleId","updateCapsules","close","show","length"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport BN from \"bn.js\";\nimport styled from \"styled-components\";\n\nimport {\n  addAssets,\n  getTokenContract,\n  tokenApproved,\n} from \"../services/contracthelper\";\nimport { selectTokens } from \"../state/tokenSlice\";\nimport { Asset } from \"../types/CapsuleType\";\nimport Token from \"../types/Token\";\nimport Assets from \"./Assets\";\nimport Popup from \"./Popup\";\nimport { getGlobals } from \"../utils/globals\";\n\nconst StyledAddAssets = styled.div`\n  width: 100%;\n`;\n\ntype Approval = {\n  asset: Asset;\n  approved: boolean;\n};\n\ntype Props = {\n  capsuleId: number;\n  show: boolean;\n  close: () => void;\n  updateCapsules: () => void;\n};\n\nconst AddAssets = (props: Props): JSX.Element => {\n  const tokens = useSelector(selectTokens);\n\n  const ethAsset: Asset = { token: \"ETH\", value: \"0\" };\n  const approval: Approval = { asset: ethAsset, approved: true };\n\n  const [assets, setAssets] = useState<Asset[]>([ethAsset]);\n  const [loading, setLoading] = useState(false);\n  const [approvals, setApprovals] = useState<Approval[]>([approval]);\n\n  const unapproved = approvals.filter((a: Approval) => !a.approved);\n\n  const addressSymbol = (address: string) =>\n    tokens.filter((token: Token) => token.address === address)[0].symbol;\n\n  const tokenApprove = async (address: string) => {\n    const globals = await getGlobals();\n    const tokenContract = await getTokenContract(address);\n    tokenContract.methods\n      .approve(globals.CAPSULE, new BN(\"9999999999999999999999999999\"))\n      .send()\n      .on(\"transactionHash\", (hash: any) => {\n        setLoading(true);\n      })\n      .on(\"receipt\", async (receipt: any) => {\n        await updateApprovals(assets);\n        setLoading(false);\n      })\n      .on(\"error\", (err: any) => {\n        console.log(`Error: ${err}`);\n        setLoading(false);\n      });\n  };\n\n  const updateApprovals = async (assets: Asset[]) => {\n    const _approvals: Approval[] = [];\n    const promises = assets.map(async (asset: Asset) => {\n      _approvals.push({\n        asset,\n        approved: await tokenApproved(asset.token),\n      });\n    });\n    await Promise.all(promises);\n    setApprovals(_approvals);\n  };\n\n  const click = async () => {\n    setLoading(true);\n    await addAssets(props.capsuleId, assets);\n    setLoading(false);\n    props.updateCapsules();\n    props.close();\n  };\n\n  return (\n    <Popup\n      show={props.show}\n      close={props.close}\n      header=\"Add Assets\"\n      buttonText={\n        unapproved.length === 0\n          ? \"Add Assets\"\n          : `Approve ${addressSymbol(unapproved[0].asset.token)}`\n      }\n      buttonAction={() => {\n        if (unapproved.length === 0) click();\n        else tokenApprove(unapproved[0].asset.token);\n      }}\n      loading={loading}\n      content={\n        <StyledAddAssets>\n          <Assets\n            assets={assets}\n            setAssets={(assets: Asset[]) => {\n              setAssets(assets);\n              updateApprovals(assets);\n            }}\n          />\n        </StyledAddAssets>\n      }\n    />\n  );\n};\n\nexport default AddAssets;\n"]},"metadata":{},"sourceType":"module"}