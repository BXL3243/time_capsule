{"ast":null,"code":"import _regeneratorRuntime from\"/Users/richard/Downloads/crypto-capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/richard/Downloads/crypto-capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/richard/Downloads/crypto-capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/richard/Downloads/crypto-capsule/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5;import React,{useEffect,useState}from\"react\";import{useSelector}from\"react-redux\";import styled from\"styled-components\";import{getAssetRealValue,getAssetSymbol}from\"../services/contracthelper\";import{selectAddress}from\"../state/userSlice\";import Button from\"./Button\";import AddAssets from\"./AddAssets\";import BlockContent from\"./BlockContent\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Header=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  font-size: 5rem;\\n  margin-bottom: 2rem;\\n  color: var(--main);\\n  text-align: center;\\n  transform: rotate(-4deg);\\n  margin-top: -1rem;\\n\"])));var SubHeaderMain=styled.span(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  font-size: 2.5rem;\\n  color: var(--main);\\n  margin-right: 1rem;\\n\"])));var AssetContainer=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  margin: 1rem 0;\\n\"])));var TokenContainer=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: column;\\n  margin-right: 6rem;\\n\"])));var TokenAddress=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  font-size: 2rem;\\n  color: var(--sub);\\n\"])));var CapsuleAssets=function CapsuleAssets(props){var address=useSelector(selectAddress);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),addingAssets=_useState2[0],setAddingAssets=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),assetValues=_useState4[0],setAssetValues=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),assetSymbols=_useState6[0],setAssetSymbols=_useState6[1];var isOpen=!props.capsule?false:new Date(props.capsule.distributionDate).getTime()<new Date().getTime();var updateAssets=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _assetValues,valuePromises,_assetSymbols,symbolPromises;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_assetValues=[];valuePromises=props.capsule.assets.map(/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(asset){var realValue;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getAssetRealValue(asset);case 2:realValue=_context.sent;_assetValues.push({asset:asset.token,value:realValue});case 4:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref2.apply(this,arguments);};}());_assetSymbols=[];symbolPromises=props.capsule.assets.map(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(asset){var _symbol;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getAssetSymbol(asset.token);case 2:_symbol=_context2.sent;_assetSymbols.push({asset:asset.token,symbol:_symbol});case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref3.apply(this,arguments);};}());_context3.next=6;return Promise.all(valuePromises);case 6:setAssetValues(_assetValues);_context3.next=9;return Promise.all(symbolPromises);case 9:setAssetSymbols(_assetSymbols);case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function updateAssets(){return _ref.apply(this,arguments);};}();useEffect(function(){updateAssets();},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(BlockContent,{content:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{children:\"Capsule Assets\"}),props.capsule.assets.map(function(asset){return/*#__PURE__*/_jsxs(AssetContainer,{children:[/*#__PURE__*/_jsxs(TokenContainer,{children:[/*#__PURE__*/_jsx(SubHeaderMain,{children:assetSymbols.length===props.capsule.assets.length?assetSymbols.filter(function(as){return as.asset===asset.token;})[0].symbol:\"---\"}),asset.token!==\"ETH\"&&/*#__PURE__*/_jsx(TokenAddress,{children:asset.token})]}),/*#__PURE__*/_jsx(SubHeaderMain,{children:assetValues.length===props.capsule.assets.length?assetValues.filter(function(av){return av.asset===asset.token;})[0].value:\"---\"})]});}),props.capsule.grantor===address&&props.capsule.addingAssetsAllowed&&!isOpen&&/*#__PURE__*/_jsx(Button,{primary:true,text:\"Add Assets\",click:function click(){return setAddingAssets(true);}})]})}),/*#__PURE__*/_jsx(AddAssets,{capsuleId:props.capsule.id,show:addingAssets,close:function close(){return setAddingAssets(false);},updateCapsules:function updateCapsules(){return props.update();}})]});};export default CapsuleAssets;","map":{"version":3,"sources":["/Users/richard/Downloads/crypto-capsule/client/src/components/CapsuleAssets.tsx"],"names":["React","useEffect","useState","useSelector","styled","getAssetRealValue","getAssetSymbol","selectAddress","Button","AddAssets","BlockContent","Header","div","SubHeaderMain","span","AssetContainer","TokenContainer","TokenAddress","CapsuleAssets","props","address","addingAssets","setAddingAssets","assetValues","setAssetValues","assetSymbols","setAssetSymbols","isOpen","capsule","Date","distributionDate","getTime","updateAssets","_assetValues","valuePromises","assets","map","asset","realValue","push","token","value","_assetSymbols","symbolPromises","_symbol","symbol","Promise","all","length","filter","as","av","grantor","addingAssetsAllowed","id","update"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useSelector } from \"react-redux\";\nimport styled from \"styled-components\";\n\nimport { getAssetRealValue, getAssetSymbol } from \"../services/contracthelper\";\nimport { selectAddress } from \"../state/userSlice\";\nimport CapsuleType, { Asset } from \"../types/CapsuleType\";\n\nimport Button from \"./Button\";\nimport AddAssets from \"./AddAssets\";\nimport BlockContent from \"./BlockContent\";\n\nconst Header = styled.div`\n  font-size: 5rem;\n  margin-bottom: 2rem;\n  color: var(--main);\n  text-align: center;\n  transform: rotate(-4deg);\n  margin-top: -1rem;\n`;\n\nconst SubHeaderMain = styled.span`\n  font-size: 2.5rem;\n  color: var(--main);\n  margin-right: 1rem;\n`;\n\nconst AssetContainer = styled.div`\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  margin: 1rem 0;\n`;\n\nconst TokenContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  margin-right: 6rem;\n`;\n\nconst TokenAddress = styled.div`\n  font-size: 2rem;\n  color: var(--sub);\n`;\n\ntype AssetValue = {\n  asset: string;\n  value: number;\n};\n\ntype AssetSymbol = {\n  asset: string;\n  symbol: string;\n};\n\ntype Props = {\n  capsule: CapsuleType;\n  update: () => void;\n};\n\nconst CapsuleAssets = (props: Props): JSX.Element => {\n  const address = useSelector(selectAddress);\n\n  const [addingAssets, setAddingAssets] = useState(false);\n  const [assetValues, setAssetValues] = useState<AssetValue[]>([]);\n  const [assetSymbols, setAssetSymbols] = useState<AssetSymbol[]>([]);\n\n  const isOpen = !props.capsule\n    ? false\n    : new Date(props.capsule.distributionDate).getTime() < new Date().getTime();\n\n  const updateAssets = async () => {\n    const _assetValues: AssetValue[] = [];\n    const valuePromises = props.capsule.assets.map(async (asset: Asset) => {\n      const realValue = await getAssetRealValue(asset);\n      _assetValues.push({\n        asset: asset.token,\n        value: realValue,\n      });\n    });\n\n    const _assetSymbols: AssetSymbol[] = [];\n    const symbolPromises = props.capsule.assets.map(async (asset: Asset) => {\n      const _symbol = await getAssetSymbol(asset.token);\n      _assetSymbols.push({\n        asset: asset.token,\n        symbol: _symbol,\n      });\n    });\n\n    await Promise.all(valuePromises);\n    setAssetValues(_assetValues);\n    await Promise.all(symbolPromises);\n    setAssetSymbols(_assetSymbols);\n  };\n\n  useEffect(() => {\n    updateAssets();\n  }, []);\n\n  return (\n    <>\n      <BlockContent\n        content={\n          <>\n            <Header>Capsule Assets</Header>\n            {props.capsule.assets.map((asset: Asset) => (\n              <AssetContainer>\n                <TokenContainer>\n                  <SubHeaderMain>\n                    {assetSymbols.length === props.capsule.assets.length\n                      ? assetSymbols.filter(\n                          (as: AssetSymbol) => as.asset === asset.token\n                        )[0].symbol\n                      : \"---\"}\n                  </SubHeaderMain>\n                  {asset.token !== \"ETH\" && (\n                    <TokenAddress>{asset.token}</TokenAddress>\n                  )}\n                </TokenContainer>\n                <SubHeaderMain>\n                  {assetValues.length === props.capsule.assets.length\n                    ? assetValues.filter(\n                        (av: AssetValue) => av.asset === asset.token\n                      )[0].value\n                    : \"---\"}\n                </SubHeaderMain>\n              </AssetContainer>\n            ))}\n            {props.capsule.grantor === address &&\n              props.capsule.addingAssetsAllowed &&\n              !isOpen && (\n                <Button\n                  primary\n                  text=\"Add Assets\"\n                  click={() => setAddingAssets(true)}\n                />\n              )}\n          </>\n        }\n      />\n      <AddAssets\n        capsuleId={props.capsule.id}\n        show={addingAssets}\n        close={() => setAddingAssets(false)}\n        updateCapsules={() => props.update()}\n      />\n    </>\n  );\n};\n\nexport default CapsuleAssets;\n"]},"metadata":{},"sourceType":"module"}